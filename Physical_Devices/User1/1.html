<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFID Access Control Flow - LoRa & MQTT</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #fff;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: calc(100vh - 80px);
            overflow: auto;
            background: #2a2a2a;
        }

        .flow-canvas {
            position: relative;
            width: 2400px;
            height: 1600px;
            padding: 40px;
        }

        .zone-label {
            position: absolute;
            font-size: 16px;
            font-weight: bold;
            color: #4facfe;
            padding: 8px 15px;
            background: rgba(79, 172, 254, 0.1);
            border: 2px solid #4facfe;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .node {
            position: absolute;
            border-radius: 5px;
            padding: 10px 15px;
            min-width: 180px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            border: 2px solid transparent;
            z-index: 10;
        }

        .node:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.6);
            border-color: #fff;
        }

        .node-header {
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .node-icon {
            font-size: 16px;
        }

        .node-content {
            font-size: 11px;
            opacity: 0.9;
            line-height: 1.4;
        }
        
        .node-device { background: linear-gradient(135deg, #96fbc4 0%, #f9f586 100%); color: #333; }
        .node-lora { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .node-action { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
        .node-gateway { background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%); }
        .node-db { background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%); color: #333; }
        .node-mqtt { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .node-vps { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); color: #333; }

        svg.connections {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .connection-lora { stroke: #f093fb; stroke-width: 2.5; fill: none; }
        .connection-mqtt { stroke: #43e97b; stroke-width: 2.5; fill: none; stroke-dasharray: 8, 4; }
        .connection-api { stroke: #ff9a56; stroke-width: 2.5; fill: none; stroke-dasharray: 2, 4; }
        .connection-internal { stroke: #888; stroke-width: 2; fill: none; stroke-dasharray: 5, 5; }

        .info-panel {
            position: fixed;
            right: -420px; top: 80px; width: 400px;
            height: calc(100vh - 80px);
            background: #1e1e1e;
            box-shadow: -2px 0 10px rgba(0,0,0,0.5);
            transition: right 0.3s ease;
            overflow-y: auto; z-index: 100; padding: 20px;
        }
        .info-panel.active { right: 0; }
        .info-panel h3 { color: #4facfe; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #4facfe; }
        .info-section { margin-bottom: 20px; }
        .info-section h4 { color: #96fbc4; margin-bottom: 10px; font-size: 14px; }
        .info-section p, .info-section ul { font-size: 13px; line-height: 1.6; color: #ccc; }
        .info-section ul { padding-left: 20px; }
        .info-section li { margin-bottom: 5px; }
        .close-info { position: absolute; top: 10px; right: 10px; background: #ff6b6b; border: none; color: #fff; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 18px; }
        .legend { position: fixed; bottom: 20px; left: 20px; background: rgba(30, 30, 30, 0.95); padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.5); z-index: 50; }
        .legend h4 { margin-bottom: 10px; color: #4facfe; font-size: 14px; }
        .legend-item { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 12px; }
        .legend-line { width: 30px; height: 2px; }
        .code-block { background: #000; padding: 10px; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 11px; margin-top: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üö™ RFID Access Control System</h1>
        <p>ESP8266 (LoRa) ‚Üí Python Gateway (LoRa/MQTT) ‚Üí VPS Server</p>
    </div>

    <div class="canvas-container">
        <div class="flow-canvas" id="flowCanvas">
            <svg class="connections" id="connectionsSvg"></svg>
            
            <div class="zone-label" style="left: 150px; top: 20px;">ESP8266 DEVICE</div>
            <div class="zone-label" style="left: 900px; top: 20px;">GATEWAY</div>
            <div class="zone-label" style="left: 1750px; top: 20px;">‚òÅÔ∏è VPS CLOUD</div>
            
            <!-- ========== ESP8266 DEVICE ========== -->
            <div class="node node-device" style="left: 50px; top: 350px;" data-info="esp-device">
                <div class="node-header"><span class="node-icon">üìü</span><span>ESP8266</span></div>
                <div class="node-content">MFRC522 RFID Reader<br>Servo Motor<br>LoRa E32 Module</div>
            </div>
            <div class="node node-action" style="left: 350px; top: 100px;" data-info="rfid-scan">
                <div class="node-header"><span class="node-icon">üí≥</span><span>1. Scan RFID Card</span></div>
                <div class="node-content">New card detected</div>
            </div>
            <div class="node node-lora" style="left: 350px; top: 250px;" data-info="esp-lora-tx">
                <div class="node-header"><span class="node-icon">üì°</span><span>2. LoRa TX: RFID Scan</span></div>
                <div class="node-content">Binary Packet<br>UID + TS + CRC32</div>
            </div>
            <div class="node node-lora" style="left: 350px; top: 450px;" data-info="esp-lora-rx">
                <div class="node-header"><span class="node-icon">üì°</span><span>5. LoRa RX: Response</span></div>
                <div class="node-content">Wait for GRANT/DENY</div>
            </div>
            <div class="node node-action" style="left: 50px; top: 550px;" data-info="gate-control">
                <div class="node-header"><span class="node-icon">üîì</span><span>6. Gate Control</span></div>
                <div class="node-content">GRANT: Open gate<br>DENY: Do nothing</div>
            </div>
            <div class="node node-lora" style="left: 350px; top: 650px;" data-info="esp-lora-status">
                <div class="node-header"><span class="node-icon">‚ù§Ô∏è</span><span>LoRa TX: Status</span></div>
                <div class="node-content">ONLINE, ALIVE, OPEN, CLOS</div>
            </div>

            <!-- ========== GATEWAY ========== -->
            <div class="node node-gateway" style="left: 930px; top: 350px;" data-info="gateway-app">
                <div class="node-header"><span class="node-icon">üêç</span><span>Gateway</span></div>
                <!-- <div class="node-content">gateway_Anh.py</div> -->
            </div>
            <div class="node node-lora" style="left: 650px; top: 250px;" data-info="gw-lora-rx">
                <div class="node-header"><span class="node-icon">üì°</span><span>3. LoRa RX: Packet</span></div>
                <div class="node-content">From ESP Device</div>
            </div>
            <div class="node node-db" style="left: 1200px; top: 250px;" data-info="gw-db">
                <div class="node-header"><span class="node-icon">üíæ</span><span>4. Local DB Lookup</span></div>
                <div class="node-content">devices.json<br>Verify UID</div>
            </div>
            <div class="node node-lora" style="left: 650px; top: 450px;" data-info="gw-lora-tx">
                <div class="node-header"><span class="node-icon">üì°</span><span>4a. LoRa TX: Response</span></div>
                <div class="node-content">Send GRANT/DENY</div>
            </div>
            <div class="node node-mqtt" style="left: 1200px; top: 450px;" data-info="gw-mqtt-tx">
                <div class="node-header"><span class="node-icon">üì§</span><span>4b. MQTT TX: Log</span></div>
                <div class="node-content">Publish access log to VPS</div>
            </div>
            <div class="node node-mqtt" style="left: 1200px; top: 650px;" data-info="gw-mqtt-status">
                <div class="node-header"><span class="node-icon">üì§</span><span>MQTT TX: Status</span></div>
                <div class="node-content">Publish device & gateway status</div>
            </div>
            <div class="node node-mqtt" style="left: 930px; top: 850px;" data-info="gw-mqtt-rx">
                <div class="node-header"><span class="node-icon">üì•</span><span>B. MQTT RX: Command</span></div>
                <div class="node-content">From VPS<br>unlock / lock</div>
            </div>
             <div class="node node-lora" style="left: 650px; top: 850px;" data-info="gw-lora-cmd">
                <div class="node-header"><span class="node-icon">üì°</span><span>C. LoRa TX: Command</span></div>
                <div class="node-content">Relay command to ESP</div>
            </div>

            <!-- ========== VPS CLOUD ========== -->
            <div class="node node-vps" style="left: 1800px; top: 450px;" data-info="vps-broker">
                <div class="node-header"><span class="node-icon">‚òÅÔ∏è</span><span>VPS MQTT Broker</span></div>
                <div class="node-content">159.223.63.61:8883 (TLS)</div>
            </div>
            <div class="node node-vps" style="left: 2100px; top: 850px;" data-info="vps-dashboard">
                <div class="node-header"><span class="node-icon">üñ•Ô∏è</span><span>A. Web Dashboard</span></div>
                <div class="node-content">Admin sends remote command</div>
            </div>
            <div class="node node-vps" style="left: 2100px; top: 450px;" data-info="vps-db">
                <div class="node-header"><span class="node-icon">üóÉÔ∏è</span><span>Cloud Database</span></div>
                <div class="node-content">Store access logs<br>Manage users/devices</div>
            </div>
            <div class="node node-vps" style="left: 1800px; top: 100px;" data-info="vps-api">
                <div class="node-header"><span class="node-icon">üåê</span><span>Sync API</span></div>
                <div class="node-content">Provides device database<br>to Gateway</div>
            </div>
        </div>
    </div>

    <div class="legend">
        <h4>üìå Legend:</h4>
        <div class="legend-item"><div class="legend-line" style="background: #f093fb;"></div><span>LoRa Communication</span></div>
        <div class="legend-item"><div class="legend-line" style="background: #43e97b; border-top: 2px dashed #43e97b;"></div><span>MQTT Communication</span></div>
        <div class="legend-item"><div class="legend-line" style="background: #ff9a56; border-top: 2px dashed #ff9a56;"></div><span>API Communication</span></div>
        <div class="legend-item"><div class="legend-line" style="background: #888; border-top: 2px dashed #888;"></div><span>Internal Process</span></div>
    </div>

    <div class="info-panel" id="infoPanel"><button class="close-info" onclick="closeInfo()">√ó</button><div id="infoPanelContent"></div></div>

    <script>
        function getNodeSide(node, side) {
            const rect = node.getBoundingClientRect();
            const canvasRect = document.getElementById('flowCanvas').getBoundingClientRect();
            const x = rect.left - canvasRect.left;
            const y = rect.top - canvasRect.top;
            switch (side) {
                case 'left': return { x: x, y: y + rect.height / 2 };
                case 'right': return { x: x + rect.width, y: y + rect.height / 2 };
                case 'top': return { x: x + rect.width / 2, y: y };
                case 'bottom': return { x: x + rect.width / 2, y: y + rect.height };
                default: return { x: x + rect.width / 2, y: y + rect.height / 2 };
            }
        }

        function drawConnections() {
            const svg = document.getElementById('connectionsSvg');
            svg.innerHTML = '';
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const markers = [
                {id: 'arrowLora', color: '#f093fb'},
                {id: 'arrowMqtt', color: '#43e97b'},
                {id: 'arrowApi', color: '#ff9a56'},
                {id: 'arrowInternal', color: '#888'}
            ];
            markers.forEach(m => {
                const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
                marker.setAttribute('id', m.id);
                marker.setAttribute('viewBox', '0 0 10 10');
                marker.setAttribute('refX', '8');
                marker.setAttribute('refY', '5');
                marker.setAttribute('markerWidth', '6');
                marker.setAttribute('markerHeight', '6');
                marker.setAttribute('orient', 'auto');
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', 'M 0 0 L 10 5 L 0 10 z');
                path.setAttribute('fill', m.color);
                marker.appendChild(path);
                defs.appendChild(marker);
            });
            svg.appendChild(defs);

            const connections = [
                // Flow 1: RFID Access
                { from: '[data-info="rfid-scan"]' , to: '[data-info="esp-lora-tx"]' , type: 'internal' },
                { from: '[data-info="esp-lora-tx"]' , to: '[data-info="gw-lora-rx"]' , type: 'lora' },
                { from: '[data-info="gw-lora-rx"]' , to: '[data-info="gateway-app"]' , type: 'internal' },
                { from: '[data-info="gateway-app"]' , fromSide: 'right', to: '[data-info="gw-db"]' , toSide: 'left', type: 'internal' },
                { from: '[data-info="gw-db"]' , fromSide: 'bottom', to: '[data-info="gateway-app"]' , toSide: 'right', type: 'internal' },
                { from: '[data-info="gateway-app"]' , to: '[data-info="gw-lora-tx"]' , type: 'internal' },
                { from: '[data-info="gw-lora-tx"]' , to: '[data-info="esp-lora-rx"]' , type: 'lora' },
                { from: '[data-info="esp-lora-rx"]' , to: '[data-info="gate-control"]' , type: 'internal' },
                { from: '[data-info="gate-control"]' , to: '[data-info="esp-device"]' , type: 'internal' },

                // Flow 1b: Logging
                { from: '[data-info="gateway-app"]' , fromSide: 'right', to: '[data-info="gw-mqtt-tx"]' , toSide: 'left', type: 'internal' },
                { from: '[data-info="gw-mqtt-tx"]' , to: '[data-info="vps-broker"]' , type: 'mqtt' },
                { from: '[data-info="vps-broker"]' , fromSide: 'right', to: '[data-info="vps-db"]' , toSide: 'left', type: 'mqtt' },

                // Flow 2: Remote Command
                { from: '[data-info="vps-dashboard"]' , to: '[data-info="vps-broker"]' , type: 'mqtt' },
                { from: '[data-info="vps-broker"]' , to: '[data-info="gw-mqtt-rx"]' , type: 'mqtt' },
                { from: '[data-info="gw-mqtt-rx"]' , to: '[data-info="gateway-app"]' , type: 'internal' },
                { from: '[data-info="gateway-app"]' , to: '[data-info="gw-lora-cmd"]' , type: 'internal' },
                { from: '[data-info="gw-lora-cmd"]' , to: '[data-info="esp-lora-rx"]' , type: 'lora' },

                // Flow 3: Status & Heartbeat
                { from: '[data-info="esp-device"]' , to: '[data-info="esp-lora-status"]' , type: 'internal' },
                { from: '[data-info="esp-lora-status"]' , to: '[data-info="gw-lora-rx"]' , type: 'lora' },
                { from: '[data-info="gateway-app"]' , fromSide: 'right', to: '[data-info="gw-mqtt-status"]' , toSide: 'left', type: 'internal' },
                { from: '[data-info="gw-mqtt-status"]' , to: '[data-info="vps-broker"]' , type: 'mqtt' },

                // Flow 4: DB Sync
                { from: '[data-info="vps-api"]' , to: '[data-info="gateway-app"]' , type: 'api' },
            ];
            
            connections.forEach(conn => {
                const fromNode = document.querySelector(conn.from);
                const toNode = document.querySelector(conn.to);
                if (!fromNode || !toNode) return;

                const start = getNodeSide(fromNode, conn.fromSide || 'right');
                const end = getNodeSide(toNode, conn.toSide || 'left');
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const dx = end.x - start.x;
                const dy = end.y - start.y;
                let pathData = `M ${start.x} ${start.y} C ${start.x + dx * 0.5} ${start.y}, ${end.x - dx * 0.5} ${end.y}, ${end.x} ${end.y}`;
                if (conn.from.includes('vps-api') || conn.to.includes('vps-api')) {
                    pathData = `M ${start.x} ${start.y} C ${start.x}, ${start.y + dy * 0.8}, ${end.x}, ${end.y - dy * 0.2}, ${end.x} ${end.y}`;
                } else if (Math.abs(dy) > Math.abs(dx)) {
                     pathData = `M ${start.x} ${start.y} C ${start.x} ${start.y + dy * 0.5}, ${end.x} ${end.y - dy * 0.5}, ${end.x} ${end.y}`;
                }
                path.setAttribute('d', pathData);
                path.classList.add(`connection-${conn.type}`);
                path.setAttribute('marker-end', `url(#arrow${conn.type.charAt(0).toUpperCase() + conn.type.slice(1)})`);
                svg.appendChild(path);
            });
        }
        
        window.addEventListener('load', drawConnections);
        window.addEventListener('resize', drawConnections);

        const nodeInfo = {
            'esp-device': {
                title: 'üìü ESP8266 RFID Device',
                sections: [
                    {heading: 'Hardware', content: '<ul><li>ESP8266 Microcontroller</li><li>MFRC522 RFID Reader</li><li>LoRa E32 Module for long-range communication</li><li>Servo motor for gate mechanism</li></ul>'},
                    {heading: 'Function', content: '<p>Reads RFID cards, sends UID to Gateway via LoRa, waits for a command, and controls the servo motor. Also sends periodic heartbeat/status messages.</p>'},
                    {heading: 'Code', content: '<p><code>devices/RFID/src/main.cpp</code></p>'}
                ]
            },
            'rfid-scan': {
                title: 'üí≥ 1. Scan RFID Card',
                sections: [
                    {heading: 'Trigger', content: '<p>An RFID card is held near the MFRC522 reader.</p>'},
                    {heading: 'Action', content: '<p>The ESP8266 reads the unique identifier (UID) of the card.</p>'}
                ]
            },
            'esp-lora-tx': {
                title: 'üì° 2. LoRa TX: RFID Scan',
                sections: [
                    {heading: 'Protocol', content: '<p>A custom binary protocol is used.</p>'},
                    {heading: 'Payload', content: '<div class="code-block">Header | MsgType | DeviceType | Seq | Timestamp | UID | CRC32</div>'},
                    {heading: 'Purpose', content: '<p>Sends the scanned RFID card UID to the Gateway for validation. The CRC32 ensures data integrity over the wireless link.</p>'}
                ]
            },
            'esp-lora-rx': {
                title: 'üì° 5. LoRa RX: Response/Command',
                sections: [
                    {heading: 'Action', content: '<p>Listens for incoming messages from the Gateway.</p>'},
                    {heading: 'Message Types', content: '<ul><li><b>Access Response:</b> Receives "GRANT" or "DENY5" after an RFID scan.</li><li><b>Remote Command:</b> Receives "REMOTE_UNLOCK" or "REMOTE_LOCK" initiated from the server.</li></ul>'}
                ]
            },
            'gate-control': {
                title: 'üîì 6. Gate Control',
                sections: [
                    {heading: 'Logic', content: '<ul><li>On "GRANT": Rotates servo to open the gate for 5 seconds, then closes it.</li><li>On "DENY5": Does nothing, the gate remains locked.</li><li>On "REMOTE_UNLOCK": Opens the gate for a specified duration.</li></ul>'}
                ]
            },
            'esp-lora-status': {
                title: '‚ù§Ô∏è LoRa TX: Status',
                sections: [
                    {heading: 'Purpose', content: '<p>Periodically sends its status to the gateway to show it is operational.</p>'},
                    {heading: 'Status Messages', content: '<ul><li><b>ONLINE</b>: Sent on startup.</li><li><b>ALIVE</b>: Sent every 60 seconds as a heartbeat.</li><li><b>OPEN/CLOS</b>: Sent when the gate is opened or closed.</li></ul>'}
                ]
            },
            'gateway-app': {
                title: 'üêç Gateway Application',
                sections: [
                    {heading: 'Function', content: '<p>A Python application that acts as a bridge between the LoRa network and the internet (MQTT).</p>'},
                    {heading: 'Responsibilities', content: '<ul><li>Receives LoRa messages from devices.</li><li>Validates RFID cards against a local database.</li><li>Sends commands back to devices via LoRa.</li><li>Logs all events to a central VPS server via MQTT.</li><li>Receives remote commands from the VPS via MQTT.</li><li>Keeps its local database synchronized with the VPS.</li></ul>'},
                    {heading: 'Code', content: '<p><code>Gateway/gateway_Anh.py</code></p>'}
                ]
            },
            'gw-lora-rx': {
                title: 'üì° 3. LoRa RX: Packet from Device',
                sections: [
                    {heading: 'Action', content: '<p>The gateway\'s LoRa module receives a binary packet from the ESP8266 device.</p>'}
                ]
            },
            'gw-db': {
                title: 'üíæ 4. Local DB Lookup',
                sections: [
                    {heading: 'Database', content: '<p>A local JSON file (<code>devices.json</code>) that contains a list of authorized RFID cards, their status (active/inactive), and expiration dates.</p>'},
                    {heading: 'Action', content: '<p>The gateway checks if the received RFID UID exists in this database and is authorized for access.</p>'}
                ]
            },
            'gw-lora-tx': {
                title: 'üì° 4a. LoRa TX: Response',
                sections: [
                    {heading: 'Action', content: '<p>Sends a message back to the ESP8266 device.</p>'},
                    {heading: 'Payload', content: '<ul><li>Sends "GRANT" or "DENY5" based on the database lookup.</li></ul>'}
                ]
            },
            'gw-mqtt-tx': {
                title: 'üì§ 4b. MQTT TX: Log',
                sections: [
                    {heading: 'Topic', content: '<p><code>gateway/Gateway1/access/{device_id}</code></p>'},
                    {heading: 'Payload', content: '<p>A JSON object containing details of the access attempt (UID, result, timestamp, reason for denial).</p>'},
                    {heading: 'Purpose', content: '<p>To create a central audit trail of all access events on the VPS.</p>'}
                ]
            },
            'gw-mqtt-status': {
                title: 'üì§ MQTT TX: Status',
                sections: [
                    {heading: 'Topics', content: '<ul><li><code>gateway/Gateway1/status/{device_id}</code></li><li><code>gateway/Gateway1/status/gateway</code></li></ul>'},
                    {heading: 'Purpose', content: '<p>Forwards device status (ONLINE, ALIVE) and also sends its own gateway status to the VPS for monitoring.</p>'}
                ]
            },
            'gw-mqtt-rx': {
                title: 'üì• B. MQTT RX: Command',
                sections: [
                    {heading: 'Topic', content: '<p>Subscribes to <code>gateway/Gateway1/command/#</code></p>'},
                    {heading: 'Action', content: '<p>Listens for commands published by the VPS, such as remotely unlocking a specific gate.</p>'}
                ]
            },
            'gw-lora-cmd': {
                title: 'üì° C. LoRa TX: Command',
                sections: [
                    {heading: 'Action', content: '<p>Translates the MQTT command into a binary LoRa packet and sends it to the target ESP device.</p>'}
                ]
            },
            'vps-broker': {
                title: '‚òÅÔ∏è VPS MQTT Broker',
                sections: [
                    {heading: 'Function', content: '<p>A central, cloud-based MQTT broker that allows communication between the Gateway and the VPS backend services.</p>'},
                    {heading: 'Security', content: '<p>Communication is secured using TLS client certificates to ensure only authorized gateways can connect.</p>'}
                ]
            },
            'vps-dashboard': {
                title: 'üñ•Ô∏è A. Web Dashboard',
                sections: [
                    {heading: 'Function', content: '<p>A web interface for administrators.</p>'},
                    {heading: 'Features', content: '<ul><li>View real-time status of all gateways and devices.</li><li>Review access logs from the cloud database.</li><li>Send remote commands (e.g., "unlock gate") to a device.</li><li>Manage users and RFID cards.</li></ul>'}
                ]
            },
            'vps-db': {
                title: 'üóÉÔ∏è Cloud Database',
                sections: [
                    {heading: 'Storage', content: '<p>A central database (e.g., MongoDB, PostgreSQL) on the server.</p>'},
                    {heading: 'Collections', content: '<ul><li><b>Access Logs:</b> Stores every access attempt from all devices.</li><li><b>Users/Devices:</b> The master database of all users, RFID cards, and their permissions. This is the source of truth for the gateway\'s local database.</li></ul>'}
                ]
            },
            'vps-api': {
                title: 'üåê Sync API',
                sections: [
                    {heading: 'Function', content: '<p>An HTTP API endpoint on the VPS.</p>'},
                    {heading: 'Purpose', content: '<p>The gateway periodically calls this API to download the latest version of the user/device database, ensuring that changes made on the web dashboard are propagated to the gateway for local validation.</p>'}
                ]
            }
        };
        
        document.querySelectorAll('.node').forEach(node => {
            node.addEventListener('click', function() {
                const infoKey = this.getAttribute('data-info');
                const info = nodeInfo[infoKey];
                if (!info) return;
                let html = `<h3>${info.title}</h3>`;
                info.sections.forEach(section => {
                    html += `<div class="info-section"><h4>${section.heading}</h4>${section.content}</div>`;
                });
                document.getElementById('infoPanelContent').innerHTML = html;
                document.getElementById('infoPanel').classList.add('active');
            });
        });
        
        function closeInfo() {
            document.getElementById('infoPanel').classList.remove('active');
        }
    </script>
</body>
</html>
