<!doctype html>
<html lang="vi">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>IoT Control Center</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/ui.css') }}">
</head>

<body>
  <div id="toast" class="toast hidden"></div>

  <div id="login_modal" class="modal-backdrop">
    <div class="modal">
      <h2>ƒêƒÉng nh·∫≠p h·ªá th·ªëng</h2>
      <form id="login_form">
        <label class="input-label" for="login_user">T√†i kho·∫£n</label>
        <input id="login_user" name="username" placeholder="V√≠ d·ª•: user_001" autocomplete="username">

        <label class="input-label" for="login_pass">M·∫≠t kh·∫©u</label>
        <input id="login_pass" name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">

        <button id="login_btn" type="submit">ƒêƒÉng nh·∫≠p</button>
        <div id="login_hint" class="muted"></div>
      </form>
    </div>
  </div>

  <header id="app_header" class="app-header hidden">
    <div class="brand">
      <span class="brand-icon">üõ∞Ô∏è</span>
      <span>IoT Control Center</span>
    </div>
    <div class="user-section">
      <div class="user-name" id="user_name">--</div>
      <button id="btn_logout" type="button">ƒêƒÉng xu·∫•t</button>
    </div>
  </header>

  <main id="app_content" class="app-content hidden">
    <section class="card-grid" id="stats_section">
      <article class="stat-card">
        <div class="stat-title">Thi·∫øt b·ªã</div>
        <div class="stat-value" id="stat_devices_total">--</div>
        <div class="stat-meta">Online: <span id="stat_devices_online">--</span></div>
      </article>
      <article class="stat-card">
        <div class="stat-title">Gateway</div>
        <div class="stat-value" id="stat_gateways_total">--</div>
        <div class="stat-meta">Online: <span id="stat_gateways_online">--</span></div>
      </article>
      <article class="stat-card">
        <div class="stat-title">L∆∞·ª£t v√†o/ra (24h)</div>
        <div class="stat-value" id="stat_access_total">--</div>
        <div class="stat-meta">ƒê∆∞·ª£c ph√©p: <span id="stat_access_granted">--</span></div>
      </article>
      <article class="stat-card">
        <div class="stat-title">C·∫£nh b√°o (24h)</div>
        <div class="stat-value" id="stat_alerts_total">--</div>
        <div class="stat-meta" id="stat_alerts_detail">--</div>
      </article>
    </section>

    <section class="panel" data-feature="climate">
      <div class="panel-header">
        <div>
          <h2 class="panel-title">Nhi·ªát ƒë·ªô &amp; ƒê·ªô ·∫©m</h2>
          <p class="panel-subtitle" id="temperature_subtitle">D·ªØ li·ªáu 24 gi·ªù g·∫ßn nh·∫•t</p>
        </div>
        <div class="panel-actions">
          <select id="sensor_select"></select>
        </div>
      </div>
      <div class="panel-body">
        <div class="latest-reading">
          <div>Nhi·ªát ƒë·ªô: <span id="latest_temp">--</span></div>
          <div>ƒê·ªô ·∫©m: <span id="latest_humidity">--</span></div>
          <div>C·∫≠p nh·∫≠t: <span id="latest_time">--</span></div>
        </div>
        <div class="chart-wrapper">
          <canvas id="temperature_chart" height="280"></canvas>
        </div>
        <div class="panel-empty hidden" id="temperature_empty">
          Ch∆∞a c√≥ d·ªØ li·ªáu c·∫£m bi·∫øn ƒë·ªÉ hi·ªÉn th·ªã.
        </div>
      </div>
    </section>

    <section class="panel">
      <div class="panel-header">
        <h2 class="panel-title">L∆∞·ª£t v√†o/ra g·∫ßn ƒë√¢y</h2>
        <div class="panel-actions">
          <button id="refresh_access" type="button" class="secondary-btn">T·∫£i l·∫°i</button>
        </div>
      </div>
      <div class="panel-body">
        <table class="data-table">
          <thead>
            <tr>
              <th>Th·ªùi gian</th>
              <th>Thi·∫øt b·ªã</th>
              <th>Ph∆∞∆°ng th·ª©c</th>
              <th>K·∫øt qu·∫£</th>
              <th>Ng∆∞·ªùi d√πng</th>
            </tr>
          </thead>
          <tbody id="access_table_body">
            <tr>
              <td colspan="5" class="empty-cell">ƒêang t·∫£i d·ªØ li·ªáu...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="panel passkey-control" data-feature="passkey">
      <div class="panel-header">
        <div>
          <h2 class="panel-title">Passkey m·ªü c·ª≠a</h2>
          <p class="panel-subtitle">Nh·∫≠p m√£ 6 s·ªë ƒë·ªÉ g·ª≠i l·ªánh m·ªü kho√° ƒë·∫øn thi·∫øt b·ªã passkey.</p>
        </div>
        <div class="panel-actions passkey-header-actions">
          <span id="passkey_device_label" class="device-chip">Thi·∫øt b·ªã: ‚Äî</span>
        </div>
      </div>
      <div class="panel-body passkey-body">
        <div class="passkey-display-wrapper">
          <div id="passkey_display" class="passkey-display">¬∑¬∑¬∑¬∑¬∑¬∑</div>
          <div id="passkey_status" class="passkey-status muted"></div>
        </div>
        <div class="passkey-keypad" id="passkey_keypad">
          <button type="button" data-digit="1">1</button>
          <button type="button" data-digit="2">2</button>
          <button type="button" data-digit="3">3</button>
          <button type="button" data-digit="4">4</button>
          <button type="button" data-digit="5">5</button>
          <button type="button" data-digit="6">6</button>
          <button type="button" data-digit="7">7</button>
          <button type="button" data-digit="8">8</button>
          <button type="button" data-digit="9">9</button>
          <button type="button" data-action="backspace">‚å´</button>
          <button type="button" data-digit="0">0</button>
          <button type="button" data-action="clear">C</button>
        </div>
        <div class="passkey-footer">
          <button id="passkey_enter_btn" type="button" class="primary-btn">G·ª≠i l·ªánh</button>
          <button id="passkey_clear" type="button" class="secondary-btn">Xo√°</button>
        </div>
      </div>
    </section>

    <section class="panel grid-2">
      <div class="panel" data-feature="passkey-table">
        <div class="panel-header">
          <h2 class="panel-title">Passkey</h2>
          <div class="panel-actions">
            <button id="refresh_passkey" type="button" class="secondary-btn">T·∫£i l·∫°i</button>
            <button id="add_passkey_btn" type="button" class="primary-btn hidden">Th√™m passkey</button>
          </div>
        </div>
        <div class="panel-body">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Ch·ªß th·∫ª</th>
                <th>Tr·∫°ng th√°i</th>
                <th>H·∫øt h·∫°n</th>
                <th>Ghi ch√∫</th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody id="passkey_table_body">
              <tr>
                <td colspan="6" class="empty-cell">ƒêang t·∫£i d·ªØ li·ªáu...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="panel" data-feature="rfid">
        <div class="panel-header">
          <h2 class="panel-title">Danh s√°ch th·∫ª RFID</h2>
          <div class="panel-actions">
            <button id="refresh_rfid" type="button" class="secondary-btn">T·∫£i l·∫°i</button>
            <button id="add_rfid_btn" type="button" class="primary-btn hidden">Th√™m th·∫ª</button>
          </div>
        </div>
        <div class="panel-body">
          <table class="data-table">
            <thead>
              <tr>
                <th>UID</th>
                <th>Ch·ªß th·∫ª</th>
                <th>Tr·∫°ng th√°i</th>
                <th>C·∫≠p nh·∫≠t</th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody id="rfid_table_body">
              <tr>
                <td colspan="5" class="empty-cell">ƒêang t·∫£i d·ªØ li·ªáu...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
    <section class="panel" data-feature="devices">
      <div class="panel-header">
        <h2 class="panel-title">Thi·∫øt b·ªã</h2>
        <div class="panel-actions">
          <button id="refresh_devices" type="button" class="secondary-btn">T·∫£i l·∫°i</button>
        </div>
      </div>
      <div class="panel-body">
        <table class="data-table">
          <thead>
            <tr>
              <th>Thi·∫øt b·ªã</th>
              <th>Gateway</th>
              <th>Lo·∫°i</th>
              <th>Tr·∫°ng th√°i</th>
              <th>L·∫ßn cu·ªëi</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody id="devices_table_body">
            <tr>
              <td colspan="6" class="empty-cell">ƒêang t·∫£i d·ªØ li·ªáu...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="passkey_modal" class="modal-backdrop">
    <div class="modal">
      <h2 id="passkey_modal_title">Th√™m passkey</h2>
      <form id="passkey_form">
        <div class="form-grid">
          <label>
            ID passkey
            <input id="passkey_id" name="id" placeholder="ƒê·ªÉ tr·ªëng khi th√™m m·ªõi" readonly>
          </label>
          <label>
            Ch·ªß s·ªü h·ªØu (user_id)
            <input id="passkey_owner" name="owner" placeholder="VD: 00001">
          </label>
          <label>
            Passcode (6 s·ªë)
            <input id="passkey_value" name="passcode" maxlength="6" placeholder="VD: 123456" autocomplete="off">
          </label>
          <label>
            M√¥ t·∫£
            <input id="passkey_desc" name="description" placeholder="Ghi ch√∫ (tu·ª≥ ch·ªçn)">
          </label>
          <label>
            H·∫øt h·∫°n
            <input id="passkey_expire" name="expires_at" type="datetime-local">
          </label>
          <label class="checkbox-field">
            <input id="passkey_active" name="active" type="checkbox" checked>
            Ho·∫°t ƒë·ªông
          </label>
        </div>

        <div id="passkey_hint" class="muted"></div>

        <div class="modal-actions">
          <button id="passkey_cancel" type="button" class="secondary-btn">Hu·ª∑</button>
          <button id="passkey_submit" type="submit">L∆∞u</button>
        </div>
      </form>
    </div>
  </div>

  <div id="rfid_modal" class="modal-backdrop">
    <div class="modal">
      <h2 id="rfid_modal_title">Th√™m th·∫ª RFID</h2>
      <form id="rfid_form">
        <div class="form-grid">
          <label>
            UID th·∫ª
            <input id="rfid_uid" name="uid" placeholder="VD: A1B2C3D4" autocomplete="off">
          </label>
          <label>
            Ch·ªß th·∫ª (user_id)
            <input id="rfid_owner" name="user_id" placeholder="VD: 00001">
          </label>
          <label>
            Lo·∫°i th·∫ª
            <input id="rfid_type" name="card_type" value="MIFARE Classic">
          </label>
          <label>
            M√¥ t·∫£
            <input id="rfid_desc" name="description" placeholder="Ghi ch√∫ (tu·ª≥ ch·ªçn)">
          </label>
          <label>
            H·∫øt h·∫°n
            <input id="rfid_expire" name="expires_at" type="datetime-local">
          </label>
          <label class="checkbox-field">
            <input id="rfid_active" name="active" type="checkbox" checked>
            Ho·∫°t ƒë·ªông
          </label>
        </div>

        <div id="rfid_hint" class="muted"></div>

        <div class="modal-actions">
          <button id="rfid_cancel" type="button" class="secondary-btn">Hu·ª∑</button>
          <button id="rfid_submit" type="submit">Th√™m th·∫ª</button>
        </div>
      </form>
    </div>
  </div>

  <script src="/config.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="{{ url_for('static', filename='js/ui.js') }}" defer></script>
</body>

</html>